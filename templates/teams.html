{% extends "base.html" %}

{% block title %}Команды - Football Analytics{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2 class="mb-4">Футбольные команды</h2>
        
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Название</th>
                        <th>Страна</th>
                        <th>Сыграно матчей</th>
                        <th>Очки</th>
                        <th>Средние очки за матч</th>
                    </tr>
                </thead>
                <tbody>
                    {% for team in teams %}
                    <tr>
                        <td>{{ team.id }}</td>
                        <td>
                            <strong>{{ team.name }}</strong>
                        </td>
                        <td>
                            <span class="badge bg-info">{{ team.country }}</span>
                        </td>
                        <td>{{ team.matches_played }}</td>
                        <td>
                            <span class="badge bg-success">{{ team.points }}</span>
                        </td>
                        <td>
                            {% if team.matches_played > 0 %}
                            <span class="badge bg-primary">
                                {{ "%.2f"|format(team.points / team.matches_played) }}
                            </span>
                            {% else %}
                            <span class="badge bg-secondary">0.00</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Статистика команд</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Всего команд:</span>
                                <span class="badge bg-primary">{{ teams|length }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Среднее очков на команду:</span>
                                <span class="badge bg-success">
                                    {{ "%.1f"|format(teams|sum(attribute='points') / teams|length) }}
                                </span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Лучшая команда:</span>
                                <span class="badge bg-warning">
                                    {{ (teams|max(attribute='points')).name }}
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>По странам</h5>
                    </div>
                    <div class="card-body">
                        {% set countries = {} %}
                        {% for team in teams %}
                            {% if team.country not in countries %}
                                {% set _ = countries.update({team.country: 1}) %}
                            {% else %}
                                {% set _ = countries.update({team.country: countries[team.country] + 1}) %}
                            {% endif %}
                        {% endfor %}
                        
                        {% for country, count in countries.items() %}
                        <div class="mb-2">
                            <strong>{{ country }}:</strong>
                            <div class="progress">
                                <div class="progress-bar" style="width: {{ (count / teams|length * 100)|round }}%">
                                    {{ count }} команд
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
